# Firestore インデックス設定ガイド

装置別タイムライン機能を使用するには、Firestoreに複合インデックスを作成する必要があります。

## 必要なインデックス

### reservations コレクション

以下の複合インデックスを作成してください：

```
コレクション: reservations
フィールド:
  - equipmentId (Ascending)
  - startTime (Ascending)
```

## インデックス作成手順

### 方法1: Firebase Console で手動作成

1. [Firebase Console](https://console.firebase.google.com/) にアクセス
2. プロジェクトを選択
3. 左メニューから「Firestore Database」を選択
4. 上部タブの「インデックス」をクリック
5. 「複合」タブを選択
6. 「インデックスを作成」ボタンをクリック
7. 以下の設定を入力：
   - **コレクション ID**: `reservations`
   - **フィールド1**:
     - フィールドパス: `equipmentId`
     - 順序: 昇順
   - **フィールド2**:
     - フィールドパス: `startTime`
     - 順序: 昇順
   - **クエリ スコープ**: コレクション
8. 「作成」ボタンをクリック
9. インデックスの作成が完了するまで数分待ちます

### 方法2: エラーメッセージから自動作成

1. アプリで装置を選択してタイムラインを表示
2. エラーが発生した場合、コンソールにFirestoreのエラーメッセージが表示されます
3. エラーメッセージ内のリンクをクリック
4. Firebaseが自動的にインデックスを作成します
5. インデックスの作成が完了するまで数分待ちます

## インデックス作成の確認

インデックスが正しく作成されたかを確認：

1. Firebase Console の「Firestore Database」→「インデックス」→「複合」タブ
2. 以下のインデックスが「有効」状態になっていることを確認：
   ```
   reservations
   ├─ equipmentId: Ascending
   └─ startTime: Ascending
   ```

## トラブルシューティング

### エラー: "The query requires an index"

このエラーが表示された場合：
1. エラーメッセージ内のリンクをクリックしてインデックスを自動作成
2. または、上記の手順で手動作成

### インデックス作成に時間がかかる

- 既存データが多い場合、インデックス作成に数分～数十分かかることがあります
- 「ビルド中」から「有効」になるまで待ちましょう

### アプリが動作しない

- インデックスが「有効」状態になっているか確認
- ブラウザをリロード（Ctrl+R）
- アプリを再起動

## 既存のインデックス

プロジェクトで既に作成されているインデックス：

### 単一フィールド（自動）
- すべてのフィールドで自動的に作成されます

### 複合インデックス（必要に応じて作成）
1. **reservations**: `equipmentId` + `startTime` ← **新規追加**
2. その他、必要に応じて追加

## 注意事項

- インデックスの削除は慎重に行ってください
- 不要なインデックスを作成すると、書き込みパフォーマンスに影響します
- 本番環境では、開発環境でテストしてから適用してください
